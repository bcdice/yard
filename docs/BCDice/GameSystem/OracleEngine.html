<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: BCDice::GameSystem::OracleEngine
  
    &mdash; Documentation by YARD 0.9.26
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "BCDice::GameSystem::OracleEngine";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (O)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../BCDice.html" title="BCDice (module)">BCDice</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../GameSystem.html" title="BCDice::GameSystem (module)">GameSystem</a></span></span>
     &raquo; 
    <span class="title">OracleEngine</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: BCDice::GameSystem::OracleEngine
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="../Base.html" title="BCDice::Base (class)">Base</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="../Base.html" title="BCDice::Base (class)">Base</a></span></li>
          
            <li class="next">BCDice::GameSystem::OracleEngine</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/bcdice/game_system/OracleEngine.rb</dd>
  </dl>
  
</div>


  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="ID-constant" class="">ID =
          <div class="docstring">
  <div class="discussion">
    
<p>ゲームシステムの識別子</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>OracleEngine</span><span class='tstring_end'>&#39;</span></span></pre></dd>
      
        <dt id="NAME-constant" class="">NAME =
          <div class="docstring">
  <div class="discussion">
    
<p>ゲームシステム名</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>オラクルエンジン</span><span class='tstring_end'>&#39;</span></span></pre></dd>
      
        <dt id="SORT_KEY-constant" class="">SORT_KEY =
          <div class="docstring">
  <div class="discussion">
    
<p>ゲームシステム名の読みがな</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>おらくるえんしん</span><span class='tstring_end'>&#39;</span></span></pre></dd>
      
        <dt id="HELP_MESSAGE-constant" class="">HELP_MESSAGE =
          <div class="docstring">
  <div class="discussion">
    
<p>ダイスボットの使い方</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='heredoc_beg'>&lt;&lt;MESSAGETEXT</span>
<span class='tstring_content'>  ・クラッチロール （xCL+y&gt;=z)
  ダイスをx個振り、1個以上目標シフトzに到達したか判定します。修正yは全てのダイスにかかります。
  成功した時は目標シフトを、失敗した時はダイスの最大値-1シフトを返します
  zが指定されないときは、ダイスをx個を振り、それに修正yしたものを返します。
  通常、最低シフトは1、最大シフトは6です。目標シフトもそろえられます。
  また、CLの後に7を入れ、(xCL7+y&gt;=z)と入力すると最大シフトが7になります。
 ・判定 (xR6+y@c#f$b&gt;=z)
  ダイスをx個振り、大きいもの2つだけを見て達成値を算出し、成否を判定します。修正yは達成値にかかります。
  ダイスブレイクとしてbを、クリティカル値としてcを、ファンブル値としてfを指定できます。
  それぞれ指定されない時、0,12,2になります。
  クリティカル値の上限はなし、下限は2。ファンブル値の上限は12、下限は0。
  zが指定されないとき、達成値の算出のみ行います。
 ・ダメージロールのダイスブレイク (xD6+y$b)
  ダイスをx個振り、合計値を出します。修正yは合計値にかかります。
  ダイスブレイクとしてbを指定します。合計値は0未満になりません。
</span><span class='heredoc_end'>MESSAGETEXT</span></pre></dd>
      
    </dl>
  






  <h2>Instance Attribute Summary</h2>
  
  <h3 class="inherited">Attributes inherited from <span class='object_link'><a href="../Base.html" title="BCDice::Base (class)">Base</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Base.html#d66_sort_type-instance_method" title="BCDice::Base#d66_sort_type (method)">#d66_sort_type</a></span>, <span class='object_link'><a href="../Base.html#default_cmp_op-instance_method" title="BCDice::Base#default_cmp_op (method)">#default_cmp_op</a></span>, <span class='object_link'><a href="../Base.html#default_target_number-instance_method" title="BCDice::Base#default_target_number (method)">#default_target_number</a></span>, <span class='object_link'><a href="../Base.html#randomizer-instance_method" title="BCDice::Base#randomizer (method)">#randomizer</a></span>, <span class='object_link'><a href="../Base.html#reroll_dice_reroll_threshold-instance_method" title="BCDice::Base#reroll_dice_reroll_threshold (method)">#reroll_dice_reroll_threshold</a></span>, <span class='object_link'><a href="../Base.html#round_type-instance_method" title="BCDice::Base#round_type (method)">#round_type</a></span>, <span class='object_link'><a href="../Base.html#sides_implicit_d-instance_method" title="BCDice::Base#sides_implicit_d (method)">#sides_implicit_d</a></span>, <span class='object_link'><a href="../Base.html#upper_dice_reroll_threshold-instance_method" title="BCDice::Base#upper_dice_reroll_threshold (method)">#upper_dice_reroll_threshold</a></span></p>


  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clamp-instance_method" title="#clamp (instance method)">#<strong>clamp</strong>(i, min, max)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clutch_roll-instance_method" title="#clutch_roll (instance method)">#<strong>clutch_roll</strong>(string)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>クラッチロール.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#damage_roll-instance_method" title="#damage_roll (instance method)">#<strong>damage_roll</strong>(string)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>ダメージロール.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#dice_result_r-instance_method" title="#dice_result_r (instance method)">#<strong>dice_result_r</strong>(dice_total, dice_list, break_list)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#eval_game_system_specific_command-instance_method" title="#eval_game_system_specific_command (instance method)">#<strong>eval_game_system_specific_command</strong>(command)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#expr_clutch-instance_method" title="#expr_clutch (instance method)">#<strong>expr_clutch</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#expr_damage-instance_method" title="#expr_damage (instance method)">#<strong>expr_damage</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#expr_r-instance_method" title="#expr_r (instance method)">#<strong>expr_r</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(command)  &#x21d2; OracleEngine </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of OracleEngine.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#normalize_critical-instance_method" title="#normalize_critical (instance method)">#<strong>normalize_critical</strong>(critical, string)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#normalize_fumble-instance_method" title="#normalize_fumble (instance method)">#<strong>normalize_fumble</strong>(fumble, string)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#r_roll-instance_method" title="#r_roll (instance method)">#<strong>r_roll</strong>(string)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>判定.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#result_clutch-instance_method" title="#result_clutch (instance method)">#<strong>result_clutch</strong>(after_shift)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#result_damage-instance_method" title="#result_damage (instance method)">#<strong>result_damage</strong>(dice_list, break_list)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#result_r-instance_method" title="#result_r (instance method)">#<strong>result_r</strong>(dice_total, total)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="../Base.html" title="BCDice::Base (class)">Base</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Base.html#change_text-instance_method" title="BCDice::Base#change_text (method)">#change_text</a></span>, <span class='object_link'><a href="../Base.html#check_result-instance_method" title="BCDice::Base#check_result (method)">#check_result</a></span>, <span class='object_link'><a href="../Base.html#command_pattern-class_method" title="BCDice::Base.command_pattern (method)">command_pattern</a></span>, <span class='object_link'><a href="../Base.html#enable_debug-instance_method" title="BCDice::Base#enable_debug (method)">#enable_debug</a></span>, <span class='object_link'><a href="../Base.html#enabled_d9%3F-instance_method" title="BCDice::Base#enabled_d9? (method)">#enabled_d9?</a></span>, <span class='object_link'><a href="../Base.html#eval-class_method" title="BCDice::Base.eval (method)">eval</a></span>, <span class='object_link'><a href="../Base.html#eval-instance_method" title="BCDice::Base#eval (method)">#eval</a></span>, <span class='object_link'><a href="../Base.html#grich_text-instance_method" title="BCDice::Base#grich_text (method)">#grich_text</a></span>, <span class='object_link'><a href="../Base.html#prefixes_pattern-class_method" title="BCDice::Base.prefixes_pattern (method)">prefixes_pattern</a></span>, <span class='object_link'><a href="../Base.html#register_prefix-class_method" title="BCDice::Base.register_prefix (method)">register_prefix</a></span>, <span class='object_link'><a href="../Base.html#register_prefix_from_super_class-class_method" title="BCDice::Base.register_prefix_from_super_class (method)">register_prefix_from_super_class</a></span>, <span class='object_link'><a href="../Base.html#sort_add_dice%3F-instance_method" title="BCDice::Base#sort_add_dice? (method)">#sort_add_dice?</a></span>, <span class='object_link'><a href="../Base.html#sort_barabara_dice%3F-instance_method" title="BCDice::Base#sort_barabara_dice? (method)">#sort_barabara_dice?</a></span></p>

  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Translate.html" title="BCDice::Translate (module)">Translate</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Translate.html#translate-instance_method" title="BCDice::Translate#translate (method)">#translate</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(command)  &#x21d2; <tt><span class='object_link'><a href="" title="BCDice::GameSystem::OracleEngine (class)">OracleEngine</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new instance of OracleEngine.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


39
40
41
42
43</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bcdice/game_system/OracleEngine.rb', line 39</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_command'>command</span><span class='rparen'>)</span>
  <span class='kw'>super</span><span class='lparen'>(</span><span class='id identifier rubyid_command'>command</span><span class='rparen'>)</span>
  <span class='ivar'>@sort_add_dice</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='ivar'>@sort_barabara_dice</span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="clamp-instance_method">
  
    #<strong>clamp</strong>(i, min, max)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


108
109
110
111
112
113
114
115
116</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bcdice/game_system/OracleEngine.rb', line 108</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clamp'>clamp</span><span class='lparen'>(</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_min'>min</span><span class='comma'>,</span> <span class='id identifier rubyid_max'>max</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_min'>min</span>
    <span class='id identifier rubyid_min'>min</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_max'>max</span>
    <span class='id identifier rubyid_max'>max</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_i'>i</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="clutch_roll-instance_method">
  
    #<strong>clutch_roll</strong>(string)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>クラッチロール</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bcdice/game_system/OracleEngine.rb', line 57</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clutch_roll'>clutch_roll</span><span class='lparen'>(</span><span class='id identifier rubyid_string'>string</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>clutch_roll begin</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_string'>string</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_parser'>parser</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Command.html" title="BCDice::Command (module)">Command</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Command/Parser.html" title="BCDice::Command::Parser (class)">Parser</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Command/Parser.html#initialize-instance_method" title="BCDice::Command::Parser#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\d+CL[67]?</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='label'>round_type:</span> <span class='id identifier rubyid_round_type'>round_type</span><span class='rparen'>)</span>
                          <span class='period'>.</span><span class='id identifier rubyid_restrict_cmp_op_to'>restrict_cmp_op_to</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='symbol'>:&gt;=</span><span class='rparen'>)</span>

  <span class='ivar'>@cmd</span> <span class='op'>=</span> <span class='id identifier rubyid_parser'>parser</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_string'>string</span><span class='rparen'>)</span>

  <span class='kw'>unless</span> <span class='ivar'>@cmd</span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='ivar'>@times</span><span class='comma'>,</span> <span class='ivar'>@max_shift</span> <span class='op'>=</span> <span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_command'>command</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CL</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_i</span><span class='rparen'>)</span>
  <span class='ivar'>@max_shift</span> <span class='op'>||=</span> <span class='int'>6</span>
  <span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_target_number'>target_number</span> <span class='op'>=</span> <span class='id identifier rubyid_clamp'>clamp</span><span class='lparen'>(</span><span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_target_number'>target_number</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='ivar'>@max_shift</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_cmp_op'>cmp_op</span>

  <span class='kw'>if</span> <span class='ivar'>@times</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_dice_list'>dice_list</span> <span class='op'>=</span> <span class='ivar'>@randomizer</span><span class='period'>.</span><span class='id identifier rubyid_roll_barabara'>roll_barabara</span><span class='lparen'>(</span><span class='ivar'>@times</span><span class='comma'>,</span> <span class='int'>6</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_clamp'>clamp</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span> <span class='op'>+</span> <span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_modify_number'>modify_number</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='ivar'>@max_shift</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span>

  <span class='id identifier rubyid_sequence'>sequence</span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='id identifier rubyid_expr_clutch'>expr_clutch</span><span class='lparen'>(</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dice_list'>dice_list</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='id identifier rubyid_result_clutch'>result_clutch</span><span class='lparen'>(</span><span class='id identifier rubyid_dice_list'>dice_list</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='rparen'>)</span>
  <span class='rbracket'>]</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_sequence'>sequence</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> ＞ </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="damage_roll-instance_method">
  
    #<strong>damage_roll</strong>(string)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>ダメージロール</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bcdice/game_system/OracleEngine.rb', line 213</span>

<span class='kw'>def</span> <span class='id identifier rubyid_damage_roll'>damage_roll</span><span class='lparen'>(</span><span class='id identifier rubyid_string'>string</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_parser'>parser</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Command.html" title="BCDice::Command (module)">Command</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Command/Parser.html" title="BCDice::Command::Parser (class)">Parser</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Command/Parser.html#initialize-instance_method" title="BCDice::Command::Parser#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\d+D6</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='label'>round_type:</span> <span class='id identifier rubyid_round_type'>round_type</span><span class='rparen'>)</span>
                          <span class='period'>.</span><span class='id identifier rubyid_restrict_cmp_op_to'>restrict_cmp_op_to</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>
                          <span class='period'>.</span><span class='id identifier rubyid_enable_dollar'>enable_dollar</span>
  <span class='ivar'>@cmd</span> <span class='op'>=</span> <span class='id identifier rubyid_parser'>parser</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_string'>string</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='ivar'>@cmd</span>

  <span class='ivar'>@times</span> <span class='op'>=</span> <span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_command'>command</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='ivar'>@break</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_dollar'>dollar</span> <span class='op'>||</span> <span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span>

  <span class='kw'>if</span> <span class='ivar'>@times</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_dice_list'>dice_list</span> <span class='op'>=</span> <span class='ivar'>@randomizer</span><span class='period'>.</span><span class='id identifier rubyid_roll_barabara'>roll_barabara</span><span class='lparen'>(</span><span class='ivar'>@times</span><span class='comma'>,</span> <span class='int'>6</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span>
  <span class='id identifier rubyid_dice_broken'>dice_broken</span> <span class='op'>=</span> <span class='id identifier rubyid_dice_list'>dice_list</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span><span class='lparen'>(</span><span class='ivar'>@break</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_total_n'>total_n</span> <span class='op'>=</span> <span class='id identifier rubyid_dice_list'>dice_list</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='int'>0</span><span class='comma'>,</span> <span class='symbol'>:+</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_modify_number'>modify_number</span>
  <span class='id identifier rubyid_total_n'>total_n</span> <span class='op'>=</span> <span class='int'>0</span> <span class='kw'>if</span> <span class='id identifier rubyid_total_n'>total_n</span> <span class='op'>&lt;</span> <span class='int'>0</span>

  <span class='id identifier rubyid_sequence'>sequence</span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='id identifier rubyid_expr_damage'>expr_damage</span><span class='lparen'>(</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='id identifier rubyid_result_damage'>result_damage</span><span class='lparen'>(</span><span class='id identifier rubyid_dice_list'>dice_list</span><span class='comma'>,</span> <span class='id identifier rubyid_dice_broken'>dice_broken</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='id identifier rubyid_total_n'>total_n</span>
  <span class='rbracket'>]</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_sequence'>sequence</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> ＞ </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="dice_result_r-instance_method">
  
    #<strong>dice_result_r</strong>(dice_total, dice_list, break_list)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


166
167
168
169
170
171
172
173
174</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bcdice/game_system/OracleEngine.rb', line 166</span>

<span class='kw'>def</span> <span class='id identifier rubyid_dice_result_r'>dice_result_r</span><span class='lparen'>(</span><span class='id identifier rubyid_dice_total'>dice_total</span><span class='comma'>,</span> <span class='id identifier rubyid_dice_list'>dice_list</span><span class='comma'>,</span> <span class='id identifier rubyid_break_list'>break_list</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_modify_number_text'>modify_number_text</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Format.html" title="BCDice::Format (module)">Format</a></span></span><span class='period'>.</span><span class='id identifier rubyid_modifier'><span class='object_link'><a href="../Format.html#modifier-class_method" title="BCDice::Format.modifier (method)">modifier</a></span></span><span class='lparen'>(</span><span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_modify_number'>modify_number</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_break_list'>break_list</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dice_total'>dice_total</span><span class='embexpr_end'>}</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dice_list'>dice_list</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_modify_number_text'>modify_number_text</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dice_total'>dice_total</span><span class='embexpr_end'>}</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dice_list'>dice_list</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>]×[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_break_list'>break_list</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_modify_number_text'>modify_number_text</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="eval_game_system_specific_command-instance_method">
  
    #<strong>eval_game_system_specific_command</strong>(command)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


45
46
47
48
49
50
51
52
53
54</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bcdice/game_system/OracleEngine.rb', line 45</span>

<span class='kw'>def</span> <span class='id identifier rubyid_eval_game_system_specific_command'>eval_game_system_specific_command</span><span class='lparen'>(</span><span class='id identifier rubyid_command'>command</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_command'>command</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\d+CL.*</span><span class='regexp_end'>/i</span></span>
    <span class='id identifier rubyid_clutch_roll'>clutch_roll</span><span class='lparen'>(</span><span class='id identifier rubyid_command'>command</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\d+D6.*\$[+\-]?\d.*</span><span class='regexp_end'>/</span></span>
    <span class='id identifier rubyid_damage_roll'>damage_roll</span><span class='lparen'>(</span><span class='id identifier rubyid_command'>command</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\d+R6</span><span class='regexp_end'>/</span></span>
    <span class='id identifier rubyid_r_roll'>r_roll</span><span class='lparen'>(</span><span class='id identifier rubyid_command'>command</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="expr_clutch-instance_method">
  
    #<strong>expr_clutch</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


88
89
90
91
92
93
94</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bcdice/game_system/OracleEngine.rb', line 88</span>

<span class='kw'>def</span> <span class='id identifier rubyid_expr_clutch'>expr_clutch</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_max_shift'>max_shift</span> <span class='op'>=</span> <span class='ivar'>@max_shift</span> <span class='op'>==</span> <span class='int'>7</span> <span class='op'>?</span> <span class='int'>7</span> <span class='op'>:</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_cmp_op'>cmp_op</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Format.html" title="BCDice::Format (module)">Format</a></span></span><span class='period'>.</span><span class='id identifier rubyid_comparison_operator'><span class='object_link'><a href="../Format.html#comparison_operator-class_method" title="BCDice::Format.comparison_operator (method)">comparison_operator</a></span></span><span class='lparen'>(</span><span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_cmp_op'>cmp_op</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_modify_number'>modify_number</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Format.html" title="BCDice::Format (module)">Format</a></span></span><span class='period'>.</span><span class='id identifier rubyid_modifier'><span class='object_link'><a href="../Format.html#modifier-class_method" title="BCDice::Format.modifier (method)">modifier</a></span></span><span class='lparen'>(</span><span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_modify_number'>modify_number</span><span class='rparen'>)</span>

  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='ivar'>@times</span><span class='embexpr_end'>}</span><span class='tstring_content'>CL</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_max_shift'>max_shift</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_modify_number'>modify_number</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmp_op'>cmp_op</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_target_number'>target_number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="expr_damage-instance_method">
  
    #<strong>expr_damage</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


242
243
244
245
246
247</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bcdice/game_system/OracleEngine.rb', line 242</span>

<span class='kw'>def</span> <span class='id identifier rubyid_expr_damage'>expr_damage</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_modify_number'>modify_number</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Format.html" title="BCDice::Format (module)">Format</a></span></span><span class='period'>.</span><span class='id identifier rubyid_modifier'><span class='object_link'><a href="../Format.html#modifier-class_method" title="BCDice::Format.modifier (method)">modifier</a></span></span><span class='lparen'>(</span><span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_modify_number'>modify_number</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_brak'>brak</span> <span class='op'>=</span> <span class='ivar'>@break</span> <span class='op'>==</span> <span class='int'>0</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>b[</span><span class='embexpr_beg'>#{</span><span class='ivar'>@break</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>

  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='ivar'>@times</span><span class='embexpr_end'>}</span><span class='tstring_content'>D6</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_modify_number'>modify_number</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_brak'>brak</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="expr_r-instance_method">
  
    #<strong>expr_r</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


156
157
158
159
160
161
162
163
164</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bcdice/game_system/OracleEngine.rb', line 156</span>

<span class='kw'>def</span> <span class='id identifier rubyid_expr_r'>expr_r</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_modify_number'>modify_number</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Format.html" title="BCDice::Format (module)">Format</a></span></span><span class='period'>.</span><span class='id identifier rubyid_modifier'><span class='object_link'><a href="../Format.html#modifier-class_method" title="BCDice::Format.modifier (method)">modifier</a></span></span><span class='lparen'>(</span><span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_modify_number'>modify_number</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_critical'>critical</span> <span class='op'>=</span> <span class='ivar'>@critical</span> <span class='op'>==</span> <span class='int'>12</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>c[</span><span class='embexpr_beg'>#{</span><span class='ivar'>@critical</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_fumble'>fumble</span> <span class='op'>=</span> <span class='ivar'>@fumble</span> <span class='op'>==</span> <span class='int'>2</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>f[</span><span class='embexpr_beg'>#{</span><span class='ivar'>@fumble</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_brak'>brak</span> <span class='op'>=</span> <span class='ivar'>@break</span> <span class='op'>==</span> <span class='int'>0</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>b[</span><span class='embexpr_beg'>#{</span><span class='ivar'>@break</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_cmp_op'>cmp_op</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Format.html" title="BCDice::Format (module)">Format</a></span></span><span class='period'>.</span><span class='id identifier rubyid_comparison_operator'><span class='object_link'><a href="../Format.html#comparison_operator-class_method" title="BCDice::Format.comparison_operator (method)">comparison_operator</a></span></span><span class='lparen'>(</span><span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_cmp_op'>cmp_op</span><span class='rparen'>)</span>

  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='ivar'>@times</span><span class='embexpr_end'>}</span><span class='tstring_content'>R6</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_modify_number'>modify_number</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_critical'>critical</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_fumble'>fumble</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_brak'>brak</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmp_op'>cmp_op</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_target_number'>target_number</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="normalize_critical-instance_method">
  
    #<strong>normalize_critical</strong>(critical, string)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


192
193
194
195
196
197
198
199
200
201
202</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bcdice/game_system/OracleEngine.rb', line 192</span>

<span class='kw'>def</span> <span class='id identifier rubyid_normalize_critical'>normalize_critical</span><span class='lparen'>(</span><span class='id identifier rubyid_critical'>critical</span><span class='comma'>,</span> <span class='id identifier rubyid_string'>string</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>@[+-]</span><span class='regexp_end'>/</span></span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='id identifier rubyid_string'>string</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_critical'>critical</span> <span class='op'>=</span> <span class='int'>12</span> <span class='op'>+</span> <span class='id identifier rubyid_critical'>critical</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_critical'>critical</span> <span class='op'>&lt;</span> <span class='int'>2</span>
    <span class='id identifier rubyid_critical'>critical</span> <span class='op'>=</span> <span class='int'>2</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_critical'>critical</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="normalize_fumble-instance_method">
  
    #<strong>normalize_fumble</strong>(fumble, string)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


204
205
206
207
208
209
210</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bcdice/game_system/OracleEngine.rb', line 204</span>

<span class='kw'>def</span> <span class='id identifier rubyid_normalize_fumble'>normalize_fumble</span><span class='lparen'>(</span><span class='id identifier rubyid_fumble'>fumble</span><span class='comma'>,</span> <span class='id identifier rubyid_string'>string</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>#[+-]</span><span class='regexp_end'>/</span></span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='id identifier rubyid_string'>string</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_fumble'>fumble</span> <span class='op'>=</span> <span class='int'>2</span> <span class='op'>+</span> <span class='id identifier rubyid_fumble'>fumble</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_clamp'>clamp</span><span class='lparen'>(</span><span class='id identifier rubyid_fumble'>fumble</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>12</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="r_roll-instance_method">
  
    #<strong>r_roll</strong>(string)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>判定</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bcdice/game_system/OracleEngine.rb', line 119</span>

<span class='kw'>def</span> <span class='id identifier rubyid_r_roll'>r_roll</span><span class='lparen'>(</span><span class='id identifier rubyid_string'>string</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_parser'>parser</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Command.html" title="BCDice::Command (module)">Command</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Command/Parser.html" title="BCDice::Command::Parser (class)">Parser</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Command/Parser.html#initialize-instance_method" title="BCDice::Command::Parser#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\d+R6</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='label'>round_type:</span> <span class='id identifier rubyid_round_type'>round_type</span><span class='rparen'>)</span>
                          <span class='period'>.</span><span class='id identifier rubyid_restrict_cmp_op_to'>restrict_cmp_op_to</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='symbol'>:&gt;=</span><span class='rparen'>)</span>
                          <span class='period'>.</span><span class='id identifier rubyid_enable_critical'>enable_critical</span>
                          <span class='period'>.</span><span class='id identifier rubyid_enable_fumble'>enable_fumble</span>
                          <span class='period'>.</span><span class='id identifier rubyid_enable_dollar'>enable_dollar</span>
  <span class='ivar'>@cmd</span> <span class='op'>=</span> <span class='id identifier rubyid_parser'>parser</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_string'>string</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='ivar'>@cmd</span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='ivar'>@times</span> <span class='op'>=</span> <span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_command'>command</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>

  <span class='kw'>if</span> <span class='ivar'>@times</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='ivar'>@critical</span> <span class='op'>=</span> <span class='id identifier rubyid_normalize_critical'>normalize_critical</span><span class='lparen'>(</span><span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_critical'>critical</span> <span class='op'>||</span> <span class='int'>12</span><span class='comma'>,</span> <span class='id identifier rubyid_string'>string</span><span class='rparen'>)</span>
  <span class='ivar'>@fumble</span> <span class='op'>=</span> <span class='id identifier rubyid_normalize_fumble'>normalize_fumble</span><span class='lparen'>(</span><span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_fumble'>fumble</span> <span class='op'>||</span> <span class='int'>2</span><span class='comma'>,</span> <span class='id identifier rubyid_string'>string</span><span class='rparen'>)</span>
  <span class='ivar'>@break</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_dollar'>dollar</span> <span class='op'>||</span> <span class='int'>0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span>

  <span class='id identifier rubyid_dice_list'>dice_list</span> <span class='op'>=</span> <span class='ivar'>@randomizer</span><span class='period'>.</span><span class='id identifier rubyid_roll_barabara'>roll_barabara</span><span class='lparen'>(</span><span class='ivar'>@times</span><span class='comma'>,</span> <span class='int'>6</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span>
  <span class='id identifier rubyid_dice_broken'>dice_broken</span> <span class='op'>=</span> <span class='id identifier rubyid_dice_list'>dice_list</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span><span class='lparen'>(</span><span class='ivar'>@break</span><span class='rparen'>)</span>

  <span class='comment'># ブレイク後のダイスから最大値２つの合計がダイスの値
</span>  <span class='id identifier rubyid_dice_total'>dice_total</span> <span class='op'>=</span> <span class='id identifier rubyid_dice_list'>dice_list</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='int'>0</span><span class='comma'>,</span> <span class='symbol'>:+</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_total'>total</span> <span class='op'>=</span> <span class='id identifier rubyid_dice_total'>dice_total</span> <span class='op'>+</span> <span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_modify_number'>modify_number</span>

  <span class='id identifier rubyid_sequence'>sequence</span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='id identifier rubyid_expr_r'>expr_r</span><span class='lparen'>(</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='id identifier rubyid_dice_result_r'>dice_result_r</span><span class='lparen'>(</span><span class='id identifier rubyid_dice_total'>dice_total</span><span class='comma'>,</span> <span class='id identifier rubyid_dice_list'>dice_list</span><span class='comma'>,</span> <span class='id identifier rubyid_dice_broken'>dice_broken</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='id identifier rubyid_result_r'>result_r</span><span class='lparen'>(</span><span class='id identifier rubyid_dice_total'>dice_total</span><span class='comma'>,</span> <span class='id identifier rubyid_total'>total</span><span class='rparen'>)</span>
  <span class='rbracket'>]</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_sequence'>sequence</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> ＞ </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="result_clutch-instance_method">
  
    #<strong>result_clutch</strong>(after_shift)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


96
97
98
99
100
101
102
103
104
105
106</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bcdice/game_system/OracleEngine.rb', line 96</span>

<span class='kw'>def</span> <span class='id identifier rubyid_result_clutch'>result_clutch</span><span class='lparen'>(</span><span class='id identifier rubyid_after_shift'>after_shift</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_cmp_op'>cmp_op</span> <span class='op'>!=</span> <span class='symbol'>:&gt;=</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>シフト</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_after_shift'>after_shift</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_after_shift'>after_shift</span> <span class='op'>&gt;=</span> <span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_target_number'>target_number</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>成功 シフト</span><span class='embexpr_beg'>#{</span><span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_target_number'>target_number</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_after_shift'>after_shift</span> <span class='op'>-=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_after_shift'>after_shift</span> <span class='op'>=</span> <span class='int'>1</span> <span class='kw'>if</span> <span class='id identifier rubyid_after_shift'>after_shift</span> <span class='op'>&lt;</span> <span class='int'>1</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>失敗 シフト</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_after_shift'>after_shift</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="result_damage-instance_method">
  
    #<strong>result_damage</strong>(dice_list, break_list)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


249
250
251
252
253
254
255
256
257
258</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bcdice/game_system/OracleEngine.rb', line 249</span>

<span class='kw'>def</span> <span class='id identifier rubyid_result_damage'>result_damage</span><span class='lparen'>(</span><span class='id identifier rubyid_dice_list'>dice_list</span><span class='comma'>,</span> <span class='id identifier rubyid_break_list'>break_list</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dice_total'>dice_total</span> <span class='op'>=</span> <span class='id identifier rubyid_dice_list'>dice_list</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='int'>0</span><span class='comma'>,</span> <span class='symbol'>:+</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_modify_number_text'>modify_number_text</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Format.html" title="BCDice::Format (module)">Format</a></span></span><span class='period'>.</span><span class='id identifier rubyid_modifier'><span class='object_link'><a href="../Format.html#modifier-class_method" title="BCDice::Format.modifier (method)">modifier</a></span></span><span class='lparen'>(</span><span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_modify_number'>modify_number</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_break_list'>break_list</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dice_total'>dice_total</span><span class='embexpr_end'>}</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dice_list'>dice_list</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_modify_number_text'>modify_number_text</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dice_total'>dice_total</span><span class='embexpr_end'>}</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dice_list'>dice_list</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>]×[</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_break_list'>break_list</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_modify_number_text'>modify_number_text</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="result_r-instance_method">
  
    #<strong>result_r</strong>(dice_total, total)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


176
177
178
179
180
181
182
183
184
185
186
187
188
189
190</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bcdice/game_system/OracleEngine.rb', line 176</span>

<span class='kw'>def</span> <span class='id identifier rubyid_result_r'>result_r</span><span class='lparen'>(</span><span class='id identifier rubyid_dice_total'>dice_total</span><span class='comma'>,</span> <span class='id identifier rubyid_total'>total</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_dice_total'>dice_total</span> <span class='op'>&lt;=</span> <span class='ivar'>@fumble</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ファンブル!</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_dice_total'>dice_total</span> <span class='op'>&gt;=</span> <span class='ivar'>@critical</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>クリティカル!</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_cmp_op'>cmp_op</span> <span class='op'>==</span> <span class='symbol'>:&gt;=</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_total'>total</span> <span class='op'>&gt;=</span> <span class='ivar'>@cmd</span><span class='period'>.</span><span class='id identifier rubyid_target_number'>target_number</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_total'>total</span><span class='embexpr_end'>}</span><span class='tstring_content'> 成功</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_total'>total</span><span class='embexpr_end'>}</span><span class='tstring_content'> 失敗</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_total'>total</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Thu Apr  1 03:10:07 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.26 (ruby-2.7.1).
</div>

    </div>
  </body>
</html>