<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: DiceBotLoader
  
    &mdash; Documentation by YARD 0.9.24
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "DiceBotLoader";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (D)</a> &raquo;
    
    
    <span class="title">DiceBotLoader</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: DiceBotLoader
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">DiceBotLoader</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>src/diceBot/DiceBotLoader.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>ダイスボットの読み込みを担当するクラス</p>


  </div>
</div>
<div class="tags">
  

</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="BOT_NAME_PATTERN-constant" class="">BOT_NAME_PATTERN =
          <div class="docstring">
  <div class="discussion">
    
<p>ボットの名前として有効なパターン（クラス名のパターン）</p>
<ul><li>
<p>最初の文字は大文字のアルファベット</p>
</li><li>
<p>2文字目以降は英数字かアンダースコア（_）</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="https://docs.ruby-lang.org/ja/1.8.7/doc/spec=2flexical.html#identifier" target="_parent" title="https://docs.ruby-lang.org/ja/1.8.7/doc/spec=2flexical.html#identifier">https://docs.ruby-lang.org/ja/1.8.7/doc/spec=2flexical.html#identifier</a></li>
    
      <li><a href="https://docs.ruby-lang.org/ja/1.8.7/doc/spec=2fvariables.html" target="_parent" title="https://docs.ruby-lang.org/ja/1.8.7/doc/spec=2fvariables.html">https://docs.ruby-lang.org/ja/1.8.7/doc/spec=2fvariables.html</a></li>
    
  </ul>

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A[A-Z]\w*\z</span><span class='regexp_end'>/</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
        <dt id="BOT_NAMES_TO_IGNORE-constant" class="">BOT_NAMES_TO_IGNORE =
          <div class="docstring">
  <div class="discussion">
    
<p>収集時に無視するボット名</p>

<p>クラス名として有効なもののみ記述する。</p>
<ul><li>
<p>最初の文字は大文字のアルファベット</p>
</li><li>
<p>2文字目以降は英数字かアンダースコア（_）</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbracket'>[</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DiceBot</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DiceBotLoader</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DiceBotLoaderList</span><span class='tstring_end'>&#39;</span></span>
<span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#collectDiceBots-class_method" title="collectDiceBots (class method)">.<strong>collectDiceBots</strong>  &#x21d2; Array&lt;DiceBot&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>ダイスボットディレクトリに含まれるダイスボットを収集する.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#loadUnknownGame-class_method" title="loadUnknownGame (class method)">.<strong>loadUnknownGame</strong>(gameType)  &#x21d2; DiceBot<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>登録されていないタイトルのダイスボットを読み込む.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#validGameType%3F-class_method" title="validGameType? (class method)">.<strong>validGameType?</strong>(gameType)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>有効なゲームタイプかを返す Object.const_getで該当するダイスボットのクラスを取得するので、 クラス名として有効な名前でなければ、無効なゲームタイプと見なす。.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(gameTitlePattern, options = {})  &#x21d2; DiceBotLoader </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>読み込み処理を初期化する できるだけ簡潔に記述できるようにするため、引数のルールを以下のように定める。.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#loadDiceBot-instance_method" title="#loadDiceBot (instance method)">#<strong>loadDiceBot</strong>  &#x21d2; DiceBot </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>ダイスボットを読み込む.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#match%3F-instance_method" title="#match? (instance method)">#<strong>match?</strong>(gameTitle)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>指定されたゲームタイトルがパターンとマッチするかを返す マッチするパターンが文字列や文字列の配列で指定されていた場合は 指定されたゲームタイトルの大文字小文字を区別しないようにする。.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(gameTitlePattern, options = {})  &#x21d2; <tt><span class='object_link'><a href="" title="DiceBotLoader (class)">DiceBotLoader</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>読み込み処理を初期化する できるだけ簡潔に記述できるようにするため、引数のルールを以下のように定める。</p>

<h1 id="label-gameTitlePattern-E3-81-AE-E5-9E-8B">gameTitlePatternの型</h1>

<p>gameTitlePatternには原則として文字列、文字列の配列、正規表現を渡すことができる。</p>

<p>従来と同様の挙動になるように、指定されたタイトルにマッチさせるときの 大文字小文字の扱いを以下のように定める。</p>
<ul><li>
<p>文字列、文字列の配列の場合は、大文字小文字を区別しない。</p>
</li><li>
<p>正規表現の場合は、正規表現のオプションに従う。</p>
</li></ul>

<h1 id="label-E5-BC-95-E6-95-B0-E3-81-8CgameTitlePattern-E3-81-AE-E3-81-BF-E3-81-AE-E5-A0-B4-E5-90-88">引数がgameTitlePatternのみの場合</h1>

<p>gameTitlePatternに文字列、文字列の配列を指定することができる。</p>

<h2 id="label-gameTitlePattern-E3-81-8C-E6-96-87-E5-AD-97-E5-88-97-E3-81-AE-E5-A0-B4-E5-90-88">gameTitlePatternが文字列の場合</h2>

<p>例：</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="" title="DiceBotLoader (class)">DiceBotLoader</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Elysion</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
</code></pre>
<ul><li>
<p>マッチするタイトルは &#39;Elysion&#39;（大文字小文字区別なし）</p>
</li><li>
<p>読み込むダイスボットファイルは diceBot/Elysion.rb（大文字小文字区別あり）</p>
</li><li>
<p>ダイスボットのクラス名は Elysion（大文字小文字区別あり）</p>
</li></ul>

<h2 id="label-gameTitlePattern-E3-81-8C-E6-96-87-E5-AD-97-E5-88-97-E3-81-AE-E9-85-8D-E5-88-97-E3-81-AE-E5-A0-B4-E5-90-88">gameTitlePatternが文字列の配列の場合</h2>

<p>例：</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="" title="DiceBotLoader (class)">DiceBotLoader</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='qwords_beg'>%w(</span><span class='tstring_content'>Cthulhu</span><span class='words_sep'> </span><span class='tstring_content'>COC</span><span class='tstring_end'>)</span></span><span class='rparen'>)</span>
</code></pre>
<ul><li>
<p>マッチするタイトルは &#39;Cthulhu&#39;, &#39;COC&#39;（大文字小文字区別なし）</p>
</li><li>
<p>読み込むダイスボットファイルは、最初に指定した diceBot/Cthulhu.rb（大文字小文字区別あり）</p>
<ul><li>
<p>最初が正式名称、以下が別名というイメージ</p>
</li></ul>
</li><li>
<p>ダイスボットのクラス名は Cthulhu（大文字小文字区別あり）</p>
</li></ul>

<h1 id="label-E3-82-AA-E3-83-97-E3-82-B7-E3-83-A7-E3-83-B3-E5-BC-95-E6-95-B0-E3-81-A8-E3-81-97-E3-81-A6+-3Afilenames+-E3-81-AE-E3-81-BF-E3-82-92-E6-B8-A1-E3-81-99-E5-A0-B4-E5-90-88">オプション引数として :filenames のみを渡す場合</h1>
<ul><li>
<p>gameTitlePatternに文字列、文字列の配列、正規表現を指定することができる。</p>
</li><li>
<p>読み込むダイスボットファイルを指定することができる。</p>
</li></ul>

<p>例：</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="" title="DiceBotLoader (class)">DiceBotLoader</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='qwords_beg'>%w(</span><span class='tstring_content'>Elric!</span><span class='words_sep'> </span><span class='tstring_content'>EL</span><span class='tstring_end'>)</span></span><span class='comma'>,</span> <span class='symbol'>:filenames</span> <span class='op'>=&gt;</span> <span class='qwords_beg'>%w(</span><span class='tstring_content'>Elric</span><span class='tstring_end'>)</span></span><span class='rparen'>)</span>
</code></pre>
<ul><li>
<p>マッチするタイトルは &#39;Elric!&#39;, &#39;EL&#39;（大文字小文字区別なし）</p>
</li><li>
<p>読み込むダイスボットファイルは diceBot/Elric.rb（大文字小文字区別あり）</p>
</li><li>
<p>ダイスボットのクラス名は :filenames で最初に指定した Elric（大文字小文字区別あり）</p>
</li></ul>

<h1 id="label-E3-82-AA-E3-83-97-E3-82-B7-E3-83-A7-E3-83-B3-E5-BC-95-E6-95-B0-E3-81-A8-E3-81-97-E3-81-A6+-3Afilenames+-E3-81-A8+-3Aclass+-E3-82-92-E6-B8-A1-E3-81-99-E5-A0-B4-E5-90-88">オプション引数として :filenames と :class を渡す場合</h1>
<ul><li>
<p>gameTitlePatternに文字列、文字列の配列、正規表現を指定することができる。</p>
</li><li>
<p>読み込むダイスボットファイルを指定することができる。</p>
</li><li>
<p>作成するダイスボットのクラス名を指定することができる。</p>
</li></ul>

<p>例：</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="" title="DiceBotLoader (class)">DiceBotLoader</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A(?:Parasite\s*Blood|PB)\z</span><span class='regexp_end'>/i</span></span><span class='comma'>,</span>
                  <span class='symbol'>:filenames</span> <span class='op'>=&gt;</span> <span class='qwords_beg'>%w(</span><span class='tstring_content'>DemonParasite</span><span class='words_sep'> </span><span class='tstring_content'>ParasiteBlood</span><span class='tstring_end'>)</span></span><span class='comma'>,</span>
                  <span class='symbol'>:class</span> <span class='op'>=&gt;</span> <span class='symbol'>:ParasiteBlood</span><span class='rparen'>)</span>
</code></pre>
<ul><li>
<p>正規表現 /A(?:Parasites*Blood|PB)z/i と指定されたタイトルをマッチさせる</p>
</li><li>
<p>読み込むダイスボットファイルは、大文字小文字区別ありで</p>
<ul><li>
<p>diceBot/DemonParasite.rb</p>
</li><li>
<p>diceBot/ParasiteBlood.rb</p>
</li></ul>
</li><li>
<p>ダイスボットのクラス名は ParasiteBlood（大文字小文字区別あり）</p>
</li></ul>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>gameTitlePattern</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="String.html" title="String (class)">String</a></span></tt>, <tt>Array&lt;<span class='object_link'><a href="String.html" title="String (class)">String</a></span>&gt;</tt>, <tt>Regexp</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ゲームタイトルのパターン</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>追加のオプション</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:filenames</span>
          <span class="type">(<tt>Array&lt;<span class='object_link'><a href="String.html" title="String (class)">String</a></span>&gt;</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>読み込むダイスボットのファイル名の配列</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:class</span>
          <span class="type">(<tt><span class='object_link'><a href="String.html" title="String (class)">String</a></span></tt>, <tt>Symbol</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>ダイスボットのクラス</p>
</div>
          
        </li>
      
    </ul>
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'src/diceBot/DiceBotLoader.rb', line 176</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_gameTitlePattern'>gameTitlePattern</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_gameTitlePattern'>gameTitlePattern</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="String.html" title="String (class)">String</a></span></span>    <span class='comment'># 扱いを簡単にするために1要素の配列に変える
</span>    <span class='comment'>#
</span>    <span class='comment'># 大文字小文字を区別しないようにするため、すべて小文字に変える
</span>
    <span class='ivar'>@gameTitlePattern</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_gameTitlePattern'>gameTitlePattern</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='const'>Array</span>    <span class='comment'># 大文字小文字を区別しないようにするため、すべて小文字に変える
</span>
    <span class='ivar'>@gameTitlePattern</span> <span class='op'>=</span> <span class='id identifier rubyid_gameTitlePattern'>gameTitlePattern</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:downcase</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'>Regexp</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:filenames</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span>
            <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>options[:filenames] is required when gameTitlePattern is a Regexp</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>

    <span class='ivar'>@gameTitlePattern</span> <span class='op'>=</span> <span class='id identifier rubyid_gameTitlePattern'>gameTitlePattern</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>TypeError</span><span class='comma'>,</span>
          <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>gameTitlePattern must be a String or an Array&lt;String&gt; or a Regexp</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># 既定の読み込むファイル名の配列
</span>  <span class='comment'># 大文字小文字を区別することに注意
</span>  <span class='id identifier rubyid_defaultFilenames'>defaultFilenames</span> <span class='op'>=</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_gameTitlePattern'>gameTitlePattern</span>
    <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="String.html" title="String (class)">String</a></span></span>
      <span class='lbracket'>[</span><span class='id identifier rubyid_gameTitlePattern'>gameTitlePattern</span><span class='rbracket'>]</span>
    <span class='kw'>when</span> <span class='const'>Array</span>
      <span class='lbracket'>[</span><span class='id identifier rubyid_gameTitlePattern'>gameTitlePattern</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rbracket'>]</span>
    <span class='kw'>when</span> <span class='const'>Regexp</span>
      <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

  <span class='ivar'>@filenames</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:filenames</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_defaultFilenames'>defaultFilenames</span>
  <span class='ivar'>@diceBotClass</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:class</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='ivar'>@filenames</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="collectDiceBots-class_method">
  
    .<strong>collectDiceBots</strong>  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="DiceBot.html" title="DiceBot (class)">DiceBot</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>ダイスボットディレクトリに含まれるダイスボットを収集する</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="DiceBot.html" title="DiceBot (class)">DiceBot</a></span>&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'src/diceBot/DiceBotLoader.rb', line 82</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_collectDiceBots'>collectDiceBots</span>
  <span class='id identifier rubyid_diceBotDir'>diceBotDir</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_expand_path'>expand_path</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='lparen'>(</span><span class='kw'>__FILE__</span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_require'>require</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_diceBotDir'>diceBotDir</span><span class='embexpr_end'>}</span><span class='tstring_content'>/DiceBot</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_botFiles'>botFiles</span> <span class='op'>=</span> <span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_glob'>glob</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_diceBotDir'>diceBotDir</span><span class='embexpr_end'>}</span><span class='tstring_content'>/*.rb</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_botNames'>botNames</span> <span class='op'>=</span>
    <span class='id identifier rubyid_botFiles'>botFiles</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_botFile'>botFile</span><span class='op'>|</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_basename'>basename</span><span class='lparen'>(</span><span class='id identifier rubyid_botFile'>botFile</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.rb</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_validBotNames'>validBotNames</span> <span class='op'>=</span>
    <span class='comment'># 特別な名前のものを除外する
</span>    <span class='lparen'>(</span><span class='id identifier rubyid_botNames'>botNames</span> <span class='op'>-</span> <span class='const'><span class='object_link'><a href="#BOT_NAMES_TO_IGNORE-constant" title="DiceBotLoader::BOT_NAMES_TO_IGNORE (constant)">BOT_NAMES_TO_IGNORE</a></span></span><span class='rparen'>)</span><span class='period'>.</span>
    <span class='comment'># 正しいクラス名になるものだけ選ぶ
</span>    <span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_botName'>botName</span><span class='op'>|</span> <span class='const'><span class='object_link'><a href="#BOT_NAME_PATTERN-constant" title="DiceBotLoader::BOT_NAME_PATTERN (constant)">BOT_NAME_PATTERN</a></span></span> <span class='op'>===</span> <span class='id identifier rubyid_botName'>botName</span> <span class='rbrace'>}</span>

  <span class='id identifier rubyid_bots'>bots</span> <span class='op'>=</span> <span class='id identifier rubyid_validBotNames'>validBotNames</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_botName'>botName</span><span class='op'>|</span>
    <span class='id identifier rubyid_require'>require</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_diceBotDir'>diceBotDir</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_botName'>botName</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='const'>Object</span><span class='period'>.</span><span class='id identifier rubyid_const_get'>const_get</span><span class='lparen'>(</span><span class='id identifier rubyid_botName'>botName</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_bots'>bots</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:sort_key</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="loadUnknownGame-class_method">
  
    .<strong>loadUnknownGame</strong>(gameType)  &#x21d2; <tt><span class='object_link'><a href="DiceBot.html" title="DiceBot (class)">DiceBot</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>登録されていないタイトルのダイスボットを読み込む</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>gameType</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ゲームタイプ</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="DiceBot.html" title="DiceBot (class)">DiceBot</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ダイスボットが存在した場合</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>読み込み時にエラーが発生した場合</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'src/diceBot/DiceBotLoader.rb', line 46</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_loadUnknownGame'>loadUnknownGame</span><span class='lparen'>(</span><span class='id identifier rubyid_gameType'>gameType</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_debug'><span class='object_link'><a href="top-level-namespace.html#debug-instance_method" title="#debug (method)">debug</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DiceBotLoader.loadUnknownGame gameType</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_gameType'>gameType</span><span class='rparen'>)</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_validGameType?'>validGameType?</span><span class='lparen'>(</span><span class='id identifier rubyid_gameType'>gameType</span><span class='rparen'>)</span>    <span class='comment'># クラス名として正しくない名前が指定された場合、後の
</span>    <span class='comment'># Object.const_getで必ず失敗するため、読み込みを中止する
</span>
    <span class='id identifier rubyid_debug'><span class='object_link'><a href="top-level-namespace.html#debug-instance_method" title="#debug (method)">debug</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DiceBotLoader.loadUnknownGame: 無効なゲームタイプ</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
          <span class='id identifier rubyid_gameType'>gameType</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='comment'># validGameType?によって &#39;.&#39; や &#39;/&#39; といったディレクトリが変わる文字が
</span>  <span class='comment'># 含まれていないことが保証されているため、必ずダイスボットディレクトリ
</span>  <span class='comment'># 直下のファイルが参照される
</span>  <span class='id identifier rubyid_fileName'>fileName</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_expand_path'>expand_path</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gameType'>gameType</span><span class='embexpr_end'>}</span><span class='tstring_content'>.rb</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='lparen'>(</span><span class='kw'>__FILE__</span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='kw'>unless</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_fileName'>fileName</span><span class='rparen'>)</span>    <span class='comment'># ファイルが存在しない場合、後のrequireで必ずLoadErrorが発生するため、
</span>    <span class='comment'># 読み込みを中止する
</span>
    <span class='id identifier rubyid_debug'><span class='object_link'><a href="top-level-namespace.html#debug-instance_method" title="#debug (method)">debug</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DiceBotLoader.loadUnknownGame: ダイスボットファイルが存在しません</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
          <span class='id identifier rubyid_gameType'>gameType</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_require'>require</span><span class='lparen'>(</span><span class='id identifier rubyid_fileName'>fileName</span><span class='rparen'>)</span>
    <span class='const'>Object</span><span class='period'>.</span><span class='id identifier rubyid_const_get'>const_get</span><span class='lparen'>(</span><span class='id identifier rubyid_gameType'>gameType</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='kw'>rescue</span> <span class='const'>LoadError</span><span class='comma'>,</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_debug'><span class='object_link'><a href="top-level-namespace.html#debug-instance_method" title="#debug (method)">debug</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DiceBotLoader.loadUnknownGame: ダイスボットの読み込みに失敗しました</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
          <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span>
    <span class='kw'>nil</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="validGameType?-class_method">
  
    .<strong>validGameType?</strong>(gameType)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>有効なゲームタイプかを返す Object.const_getで該当するダイスボットのクラスを取得するので、 クラス名として有効な名前でなければ、無効なゲームタイプと見なす。</p>

<p>また、無視するボット名の一覧に含まれるゲームタイプも無効と見なす。</p>

<p>&#39;.&#39; や &#39;/&#39; はクラス名には含まれないため、ディレクトリトラバーサル攻撃も これで防げる。</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>gameType</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ゲームタイプ</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


37
38
39
40</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'src/diceBot/DiceBotLoader.rb', line 37</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_validGameType?'>validGameType?</span><span class='lparen'>(</span><span class='id identifier rubyid_gameType'>gameType</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="#BOT_NAME_PATTERN-constant" title="DiceBotLoader::BOT_NAME_PATTERN (constant)">BOT_NAME_PATTERN</a></span></span> <span class='op'>===</span> <span class='id identifier rubyid_gameType'>gameType</span> <span class='op'>&amp;&amp;</span>
    <span class='op'>!</span><span class='const'><span class='object_link'><a href="#BOT_NAMES_TO_IGNORE-constant" title="DiceBotLoader::BOT_NAMES_TO_IGNORE (constant)">BOT_NAMES_TO_IGNORE</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_gameType'>gameType</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="loadDiceBot-instance_method">
  
    #<strong>loadDiceBot</strong>  &#x21d2; <tt><span class='object_link'><a href="DiceBot.html" title="DiceBot (class)">DiceBot</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>ダイスボットを読み込む</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="DiceBot.html" title="DiceBot (class)">DiceBot</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


233
234
235
236
237
238
239
240</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'src/diceBot/DiceBotLoader.rb', line 233</span>

<span class='kw'>def</span> <span class='id identifier rubyid_loadDiceBot'>loadDiceBot</span>
  <span class='ivar'>@filenames</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_filename'>filename</span><span class='op'>|</span>
    <span class='id identifier rubyid_require_path'>require_path</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_expand_path'>expand_path</span><span class='lparen'>(</span><span class='id identifier rubyid_filename'>filename</span><span class='comma'>,</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='lparen'>(</span><span class='kw'>__FILE__</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_require'>require</span><span class='lparen'>(</span><span class='id identifier rubyid_require_path'>require_path</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='const'>Object</span><span class='period'>.</span><span class='id identifier rubyid_const_get'>const_get</span><span class='lparen'>(</span><span class='ivar'>@diceBotClass</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="match?-instance_method">
  
    #<strong>match?</strong>(gameTitle)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>指定されたゲームタイトルがパターンとマッチするかを返す マッチするパターンが文字列や文字列の配列で指定されていた場合は 指定されたゲームタイトルの大文字小文字を区別しないようにする。</p>

<p>正規表現の場合は指定されたゲームタイトルをそのまま正規表現と マッチさせる。</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


222
223
224
225
226
227
228
229</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'src/diceBot/DiceBotLoader.rb', line 222</span>

<span class='kw'>def</span> <span class='id identifier rubyid_match?'>match?</span><span class='lparen'>(</span><span class='id identifier rubyid_gameTitle'>gameTitle</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='ivar'>@gameTitlePattern</span>
  <span class='kw'>when</span> <span class='const'>Array</span>
    <span class='ivar'>@gameTitlePattern</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_gameTitle'>gameTitle</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'>Regexp</span>
    <span class='ivar'>@gameTitlePattern</span> <span class='op'>===</span> <span class='id identifier rubyid_gameTitle'>gameTitle</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Wed May  6 12:33:13 2020 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.24 (ruby-2.7.1).
</div>

    </div>
  </body>
</html>